## cargo-graph-analyzer
Анализатор графа зависимостей для пакетов Rust (Cargo).

### Сборка

```bash
go build ./...
```

### Использование

- **Crates.io**:

```bash
depgraph get <name> repo <version> <max-depth>
```

  - берёт зависимости с `https://crates.io/api/v1/crates/<name>/<version>/dependencies`;
  - автоматически раскрывает транзитивные зависимости (DFS без рекурсии).

- **Тестовый файл**:

```bash
depgraph get <name> test </abs/path/to/graph.txt> <max-depth>
```

  - файл формата `A:B,C` или `A -> B C`, комментарии `#`/`;`.

`max-depth = 0` означает «без ограничения`. Каждая команда выводит дерево зависимостей, повторяющиеся узлы, циклы и порядок загрузки (топологическую сортировку reachable-части графа).

### Возможности

- Получение зависимостей напрямую без клонирования git‑репозиториев.
- Построение полного графа (включая транзитивные зависимости) алгоритмом DFS без рекурсии и с ограничением глубины.
- Обнаружение повторяющихся узлов (один пакет фигурирует у нескольких родителей) и циклических цепочек.
- ASCII‑дерево с указанием глубины каждого узла.
- Тестовый режим с кастомными графами из текстового файла.
- Режим показа порядка загрузки зависимостей (топологическая сортировка).

### Основные компоненты

- `internal/cli/dependencies.go` — CLI-команда `get`, валидация аргументов, выбор режима (`repo`/`test`).
- `internal/crates/api.go` — клиент crates.io: HTTP‑запросы, кеширование, подбор версий с помощью `github.com/Masterminds/semver/v3`, построение смежности.
  - `BuildAdjacencyFromRegistry` — формирует граф `crate@version -> []deps`.
  - `resolveVersion` — подбирает конкретную версию зависимости по ограничению `req`.
- `internal/graph/graph.go` — анализ и вывод графа:
  - `AnalyzeAndRender` — нерекурсивный DFS, генерация дерева, список повторов и циклов.
  - `ComputeLoadOrder` — топологическая сортировка с обнаружением циклов.
- Тестовый парсер (`parseTestGraphFile`) — читает формат `A:B,C` или `A -> B C`.

### Пример работы

#### Crates.io

Команда:

```bash
depgraph get serde repo 1.0.228 3
```

Фрагмент вывода:

```
Dependency graph for serde@1.0.228 (max-depth 3):

serde@1.0.228
`-- serde_derive@1.0.228 (depth=1)
    |-- proc-macro2@1.0.103 (depth=2)
    |-- quote@1.0.42 (depth=2)
    `-- syn@2.0.110 (depth=2)

Repeated nodes:
 - none

Load order:
 1. proc-macro2@1.0.103
 2. quote@1.0.42
 3. syn@2.0.110
 4. serde_derive@1.0.228
 5. serde@1.0.228
```

Cargo может загружать зависимости в другом порядке (параллельная загрузка, кеш, особенности версии сборщика). Здесь порядок вычисляется строгой топологической сортировкой с алфавитным разрешением конфликтов, поэтому возможные расхождения считаются нормой.

#### Тестовый режим

Файл `test.txt`:

```
A:B,C
B -> D
C -> D
```

Команда:

```bash
depgraph get A test /abs/path/test.txt 3
```

```
Dependency graph for A (max-depth 3):

A
|-- B (depth=1)
|   `-- D (depth=2)
`-- C (depth=1)
    `-- D (depth=2)

Repeated nodes:
 - D

Load order:
 1. D
 2. B
 3. C
 4. A
```
